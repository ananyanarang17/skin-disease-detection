<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact & Feedback - AI Skin Disease Detector</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<!--  Navigation -->
<header>
<nav>
<div class="nav-left">
<div class="theme-toggle-wrapper">
<label class="switch">
<input type="checkbox" id="theme-toggle">
<span class="slider round"></span>
</label>
</div>
<a href="{{ url_for('home') }}">Home</a>
<a href="{{ url_for('appointments') }}">Appointments</a>
<a href="{{ url_for('clinics') }}">Nearby Clinics</a>
<a href="{{ url_for('reports') }}">Reports</a>
<a href="{{ url_for('tips') }}">Skin Care Tips</a>
<a href="{{ url_for('about') }}">About</a>
<a href="{{ url_for('contact') }}" class="active">Contact</a>
</div>
</nav>
</header>

<!--  Auth -->
<div class="auth-section">
<button id="auth-trigger" class="auth-btn">Sign In / Sign Up</button>
</div>

<!--  Contact Form Section -->
<section class="feedback-section">
<div class="feedback-card">
<h2>ğŸ“¨ Send Us Your Feedback</h2>

<form id="feedback-form" onsubmit="return handleFeedbackSubmit(event)">
  
  <div>
    <label>Your Name</label>
    <input type="text" name="name" placeholder="Enter your Name" required>
  </div>

  <div>
    <label>Your Email</label>
    <input type="email" name="email" placeholder="you@example.com" required>
  </div>

  <div>
    <label>Your Message</label>
    <textarea name="message" placeholder="Tell us what you think..." required></textarea>
  </div>

  <div>
    <label>Feedback Type</label>
    <select name="feedback_type" required>
      <option value="">-- Select --</option>
      <option value="Bug Report">ğŸ› Bug Report</option>
      <option value="Feature Request">ğŸ’¡ Feature Request</option>
      <option value="General">ğŸ’¬ General Feedback</option>
    </select>
  </div>

  <div>
    <label>Device Type</label>
    <select name="device_type">
      <option value="Mobile">ğŸ“± Mobile</option>
      <option value="Desktop">ğŸ–¥ï¸ Desktop</option>
      <option value="Tablet">ğŸ“± Tablet</option>
    </select>
  </div>

  <input type="hidden" name="page" value="contact">
  <input type="hidden" name="rating" id="satisfaction" value="5">

  <div class="checkbox-group">
    <input type="checkbox" id="agree-checkbox" name="agree" required>
    <label for="agree-checkbox" style="margin: 0;">I agree to share this feedback</label>
  </div>

  <button type="submit">âœ‰ï¸ Submit Feedback</button>
</form>
</div>
</section>

<!-- Chatbot Widget -->
<div id="chatbot-widget">
<div id="chat-icon">ğŸ’¬</div>
<div id="chat-popup">
<div id="chat-header">
AI Assistant
<span id="close-chat" style="cursor:pointer;">âœ–</span>
</div>
<div id="chat-box"></div>
<div id="chat-input">
<input type="text" id="user-input" placeholder="Type your message..." />
<button id="send-btn">Send</button>
</div>
</div>
</div>

<!-- Inline feedback handler -->
<script>
function handleFeedbackSubmit(event) {
  event.preventDefault();
  console.log("ğŸ¯ Feedback form submitted!");
  
  const form = event.target;
  const name = form.querySelector("input[name='name']").value.trim();
  const email = form.querySelector("input[name='email']").value.trim();
  const message = form.querySelector("textarea[name='message']").value.trim();
  const feedbackType = form.querySelector("select[name='feedback_type']").value;
  const deviceType = form.querySelector("select[name='device_type']").value;
  const rating = form.querySelector("input[name='rating']").value;
  const page = form.querySelector("input[name='page']").value;
  const agree = form.querySelector("input[name='agree']").checked;

  if (!name || !email || !message) {
    alert("âš ï¸ Please fill out all required fields!");
    return false;
  }

  if (!agree) {
    alert("âš ï¸ Please agree to share this feedback!");
    return false;
  }

  const submitBtn = form.querySelector("button[type='submit']");
  const originalText = submitBtn.textContent;
  submitBtn.textContent = "â³ Sending...";
  submitBtn.disabled = true;

  fetch("/feedback", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      email,
      message,
      feedback_type: feedbackType,
      device_type: deviceType,
      rating: rating ? parseInt(rating) : null,
      page: page || "contact",
      agree: agree
    })
  })
  .then(response => response.json())
  .then(data => {
    alert("âœ… Thank you for your feedback!");
    form.reset();
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  })
  .catch(error => {
    console.error("Error:", error);
    alert("âŒ Failed to submit feedback. Please try again.");
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  });

  return false;
}
</script>

<script src="{{ url_for('static', filename='script.js') }}" defer></script>
</body>
</html>